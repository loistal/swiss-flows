<!DOCTYPE html>
<html>
<head>
    <title>Drawing line with arrow at the end</title>

    <script src="http://d3js.org/d3.v3.min.js"></script>
</head>

<body>
    <script type='text/javascript'>

    var margin = 75,
            w = 1400 - margin,
            h = 600 - margin;

    var projection = d3.geo.mercator()
                           .scale(5000)
                           .center([9.02667, 46.40111]) // because of scroll, not perfectly centered on CH
                           .translate( [w / 2, h / 2]);

    function plot_flows(data) {

        console.log(data);

        // Append an SVG element to the body
        var svg =  d3.select("body")
                    .append("svg")
                    .attr("width", w)
                    .attr("height", h);

        // Define the reusable arrow tip
        svg.append("svg:defs") // defs are used for elements that are meant to be reused
            .append("svg:marker") // markers mark the end of the line. They need to be inside a defs
            .attr("id", "triangle") // id referenced by the line 
            .attr("refX", 6) // places the arrow tip at a certain position compared to the line
            .attr("refY", 6)
            .attr("markerWidth", 30)
            .attr("markerHeight", 30)
            .attr("orient", "auto") // 'auto' indicates that the marker is oriented such that its positive x-axis is pointing in the direction of the path at the point it is placed.
            .append("path")
            .attr("d", "M 0 0 12 6 0 12 3 6") // defines the shape of the arrow tip
            .style("fill", "black"); 

        // Plot the lines programatically
        svg.selectAll("line")
           .data(data)
           .enter()
           .append("line")
           .attr("x1", function(flow) { 
             // The node's name is placed on its right side 
             return projection([flow['src_longitude'], flow['src_latitude']])[0]; 
           })
           .attr("y1", function(flow) {  
             return projection([flow['src_longitude'], flow['src_latitude']])[1];
           })
           .attr("x2", function(flow) {  
             return projection([flow['dest_longitude'], flow['dest_latitude']])[0];
           })
           .attr("y2", function(flow) {  
             return projection([flow['dest_longitude'], flow['dest_latitude']])[1];
           })
           .attr("stroke-width", 1)
           .attr("stroke", "black")
           .attr("marker-end", "url(#triangle)");

    }

    // Load the nodes and plot them 
    d3.tsv("dummy_flows.tsv", function(d) {
        return d;
    }, plot_flows);

</script>
</body>
</html>